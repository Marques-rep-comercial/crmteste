<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Orçamentos e Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .tab-active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .modal {
            display: none;
        }
        .modal-open {
            display: flex;
        }
        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Main Container -->
    <div class="min-h-screen flex flex-col">

        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <i data-lucide="file-text" class="h-8 w-8 text-blue-600"></i>
                        <h1 class="text-xl font-bold ml-2 text-gray-800">Gestor de Negócios</h1>
                    </div>
                    <div class="hidden md:block">
                        <nav id="nav-desktop" class="flex items-center space-x-4">
                            <a href="#dashboard" class="tab-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600" data-tab="dashboard">Início</a>
                            <a href="#orders" class="tab-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600" data-tab="orders">Orçamentos e Pedidos</a>
                            <a href="#products" class="tab-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600" data-tab="products">Produtos</a>
                            <a href="#customers" class="tab-link px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600" data-tab="customers">Clientes</a>
                        </nav>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            <!-- Dashboard Section -->
            <section id="dashboard" class="tab-content">
                <h2 class="text-2xl font-bold mb-6 text-gray-900">Painel de Controle</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-sm flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i data-lucide="file-text" class="h-6 w-6 text-blue-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Total de Pedidos</p>
                            <p id="total-orders-stat" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                    <div class="bg-green-100 p-6 rounded-lg shadow-sm flex items-center">
                        <div class="bg-green-200 p-3 rounded-full">
                            <i data-lucide="package" class="h-6 w-6 text-green-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Produtos Cadastrados</p>
                            <p id="total-products-stat" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                    <div class="bg-yellow-100 p-6 rounded-lg shadow-sm flex items-center">
                        <div class="bg-yellow-200 p-3 rounded-full">
                            <i data-lucide="users" class="h-6 w-6 text-yellow-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Clientes</p>
                            <p id="total-customers-stat" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                     <div class="bg-indigo-100 p-6 rounded-lg shadow-sm flex items-center">
                        <div class="bg-indigo-200 p-3 rounded-full">
                            <i data-lucide="dollar-sign" class="h-6 w-6 text-indigo-600"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Faturamento (Faturado)</p>
                            <p id="total-revenue-stat" class="text-2xl font-bold text-gray-900">R$ 0,00</p>
                        </div>
                    </div>
                </div>
                <div class="mt-8 bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-lg font-semibold mb-4">Ações Rápidas</h3>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="openOrderModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Novo Pedido</button>
                        <button onclick="openProductModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Novo Produto</button>
                        <button onclick="openCustomerModal()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Novo Cliente</button>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Orçamentos e Pedidos</h2>
                    <button onclick="openOrderModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Novo Pedido</button>
                </div>
                <div id="orders-list" class="bg-white rounded-lg shadow-sm overflow-x-auto"></div>
            </section>

            <!-- Products Section -->
            <section id="products" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Produtos</h2>
                    <button onclick="openProductModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Novo Produto</button>
                </div>
                <div id="products-list" class="bg-white rounded-lg shadow-sm overflow-x-auto"></div>
            </section>

            <!-- Customers Section -->
            <section id="customers" class="tab-content hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Clientes</h2>
                    <button onclick="openCustomerModal()" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 flex items-center"><i data-lucide="plus" class="mr-2 h-5 w-5"></i>Novo Cliente</button>
                </div>
                <div id="customers-list" class="bg-white rounded-lg shadow-sm overflow-x-auto"></div>
            </section>
        </main>
    </div>

    <!-- Order/Budget Modal -->
    <div id="orderModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full items-center justify-center z-30">
        <div class="relative mx-auto p-5 border w-full max-w-3xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 id="orderModalTitle" class="text-lg leading-6 font-medium text-gray-900 text-center">Criar Novo Pedido/Orçamento</h3>
                <form id="orderForm" class="mt-2 px-7 py-3 space-y-4 text-left">
                    <input type="hidden" id="editingOrderId" value="">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-2">
                            <label for="orderCustomer" class="text-sm font-medium">Cliente</label>
                            <select id="orderCustomer" class="w-full p-2 border border-gray-300 rounded-md mt-1" required></select>
                        </div>
                        <div>
                           <label for="orderType" class="text-sm font-medium">Tipo</label>
                            <select id="orderType" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                <option value="Orçamento">Orçamento</option>
                                <option value="Pedido">Pedido</option>
                            </select>
                        </div>
                    </div>
                     <div>
                        <label for="orderStatus" class="text-sm font-medium">Status</label>
                        <select id="orderStatus" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                            <option value="Aberto">Aberto</option>
                            <option value="Faturado">Faturado</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="border-t pt-4">
                        <h4 class="font-semibold">Itens do Pedido</h4>
                        <div id="orderItemsContainer" class="mt-2 space-y-2 max-h-48 overflow-y-auto pr-2"></div>
                        <div class="flex items-center space-x-2 mt-2">
                             <select id="productSelector" class="flex-grow p-2 border border-gray-300 rounded-md"></select>
                             <input type="number" id="itemQuantity" value="1" min="1" class="w-20 p-2 border border-gray-300 rounded-md">
                             <button type="button" id="addOrderItem" class="bg-gray-200 px-4 py-2 rounded-md hover:bg-gray-300">Adicionar</button>
                        </div>
                    </div>
                    <div class="text-right font-bold text-xl mt-4">
                        Total: <span id="orderTotal">R$ 0,00</span>
                    </div>
                    <div class="items-center px-4 py-3">
                        <button type="submit" class="w-full bg-blue-600 text-white text-base font-medium px-4 py-2 rounded-lg hover:bg-blue-700">Salvar Pedido</button>
                        <button type="button" onclick="closeModal('orderModal')" class="mt-2 w-full bg-gray-200 text-gray-800 text-base font-medium px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full items-center justify-center z-30">
        <div class="relative mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
            <form id="productForm">
                <input type="hidden" id="editingProductId">
                <div class="flex justify-between items-center pb-3 border-b">
                    <div>
                        <h3 id="productModalTitle" class="text-xl leading-6 font-bold text-gray-900">Novo Produto</h3>
                        <p id="productModalSubtitle" class="text-sm text-gray-500">Preencha os detalhes do produto abaixo.</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button type="button" onclick="closeModal('productModal')" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                        <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Salvar Produto</button>
                    </div>
                </div>
                <div class="mt-4">
                    <div>
                        <label for="productName" class="text-sm font-medium">Nome do Produto</label>
                        <input type="text" id="productName" class="w-full p-2 border border-gray-300 rounded-md mt-1" placeholder="Ex: Camiseta Branca" required>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-4">
                        <div class="md:col-span-1 flex flex-col items-center">
                            <div class="w-40 h-40 bg-gray-200 rounded-md flex items-center justify-center">
                                <i data-lucide="image" class="h-16 w-16 text-gray-400"></i>
                            </div>
                        </div>
                        <div class="md:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="productSku" class="text-sm font-medium">Código (SKU)</label>
                                <input type="text" id="productSku" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                            </div>
                            <div>
                                <label for="productFormat" class="text-sm font-medium">Formato</label>
                                <select id="productFormat" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                    <option>Simples</option>
                                    <option>Com Variações</option>
                                </select>
                            </div>
                            <div>
                                <label for="productType" class="text-sm font-medium">Tipo</label>
                                <select id="productType" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                    <option>Produto</option>
                                    <option>Serviço</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2 pt-5">
                                <label class="relative inline-flex items-center cursor-pointer">
                                  <input type="checkbox" id="productStatus" class="sr-only peer">
                                  <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                                  <span class="ml-3 text-sm font-medium text-gray-900" id="productStatusLabel">Inativo</span>
                                </label>
                            </div>
                            <div>
                                <label for="productPrice" class="text-sm font-medium">Preço Venda</label>
                                <input type="number" id="productPrice" step="0.01" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                            </div>
                             <div>
                                <label for="productUnit" class="text-sm font-medium">Unidade</label>
                                <input type="text" id="productUnit" value="UN" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 border-t pt-4">
                    <h4 class="font-semibold text-gray-700 mb-2">Características Físicas e Estoque</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="productWeight" class="text-sm font-medium">Peso Líquido</label>
                            <input type="number" id="productWeight" step="0.001" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                        </div>
                         <div>
                            <label for="productGrossWeight" class="text-sm font-medium">Peso Bruto</label>
                            <input type="number" id="productGrossWeight" step="0.001" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                        </div>
                        <div>
                            <label for="productWidth" class="text-sm font-medium">Largura</label>
                            <input type="number" id="productWidth" step="0.01" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                        </div>
                        <div>
                            <label for="productHeight" class="text-sm font-medium">Altura</label>
                            <input type="number" id="productHeight" step="0.01" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                        </div>
                         <div>
                            <label for="productDepth" class="text-sm font-medium">Profundidade</label>
                            <input type="number" id="productDepth" step="0.01" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                        </div>
                        <div>
                            <label for="productStock" class="text-sm font-medium">Estoque Atual</label>
                            <input type="number" id="productStock" step="1" class="w-full p-2 border border-gray-300 rounded-md mt-1" placeholder="0">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Customer Modal -->
    <div id="customerModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full items-center justify-center z-30">
        <div class="relative mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 id="customerModalTitle" class="text-lg leading-6 font-medium text-gray-900">Adicionar Novo Cliente</h3>
                <form id="customerForm" class="mt-2 px-7 py-3 space-y-4 text-left">
                    <input type="hidden" id="editingCustomerId">
                    <div>
                        <label for="customerName" class="text-sm font-medium">Nome</label>
                        <input type="text" id="customerName" class="w-full p-2 border border-gray-300 rounded-md mt-1" required>
                    </div>
                    <div>
                        <label for="customerEmail" class="text-sm font-medium">Email</label>
                        <input type="email" id="customerEmail" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                    </div>
                    <div>
                        <label for="customerPhone" class="text-sm font-medium">Telefone</label>
                        <input type="tel" id="customerPhone" class="w-full p-2 border border-gray-300 rounded-md mt-1">
                    </div>
                    <div class="items-center px-4 py-3">
                        <button type="submit" class="w-full bg-yellow-600 text-white text-base font-medium px-4 py-2 rounded-lg hover:bg-yellow-700">Salvar Cliente</button>
                        <button type="button" onclick="closeModal('customerModal')" class="mt-2 w-full bg-gray-200 text-gray-800 text-base font-medium px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Generic Confirmation/Alert Modal -->
    <div id="infoModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full items-center justify-center z-40">
        <div class="relative mx-auto p-5 border w-full max-w-sm shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <div id="infoModalIcon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                     <i data-lucide="alert-triangle" class="h-6 w-6 text-red-600"></i>
                </div>
                <h3 id="infoModalTitle" class="text-lg leading-6 font-medium text-gray-900 mt-2">Atenção</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="infoModalMessage" class="text-sm text-gray-500"></p>
                </div>
                <div id="infoModalButtons" class="items-center px-4 py-3 space-y-2 sm:space-y-0 sm:flex sm:space-x-2 justify-center">
                    <button id="infoModalConfirmBtn" class="w-full sm:w-auto bg-red-600 text-white text-base font-medium px-4 py-2 rounded-lg hover:bg-red-700">Confirmar</button>
                    <button id="infoModalCancelBtn" class="w-full sm:w-auto bg-gray-200 text-gray-800 text-base font-medium px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- DATABASE SIMULATION ---
        let customers = [
            { id: 1, name: 'Empresa Alpha', email: 'contato@alpha.com', phone: '11 9999-8888' },
            { id: 2, name: 'Soluções Beta', email: 'suporte@beta.com', phone: '21 8888-7777' }
        ];
        let products = [
            { id: 1, name: 'Desenvolvimento de Website', price: 3500.00, sku: 'DW-001', status: true, unit: 'UN', weight: 0, grossWeight: 0, width: 0, height: 0, depth: 0, stock: 10 },
            { id: 2, name: 'Consultoria SEO (mensal)', price: 1200.00, sku: 'SEO-001', status: true, unit: 'SV', weight: 0, grossWeight: 0, width: 0, height: 0, depth: 0, stock: null },
            { id: 3, name: 'Manutenção de Servidor', price: 450.00, sku: 'MS-001', status: false, unit: 'SV', weight: 0, grossWeight: 0, width: 0, height: 0, depth: 0, stock: null }
        ];
        let orders = [
            { id: 1, customerId: 1, type: 'Pedido', date: '2024-07-25', items: [{ productId: 1, quantity: 1, price: 3500.00 }], total: 3500.00, status: 'Faturado' },
            { id: 2, customerId: 2, type: 'Orçamento', date: '2024-07-26', items: [{ productId: 2, quantity: 3, price: 1200.00 }], total: 3600.00, status: 'Aberto' }
        ];
        let currentOrderItems = [];

        // --- RENDER FUNCTIONS ---
        function renderCustomers() {
            const list = document.getElementById('customers-list');
            if (!list) return;
            list.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telefone</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${customers.map(c => `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${c.name}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.email}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.phone}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <button onclick="openCustomerModal(${c.id})" class="text-indigo-600 hover:text-indigo-900 p-1"><i data-lucide="edit" class="h-5 w-5"></i></button>
                                    <button onclick="deleteCustomer(${c.id})" class="text-red-600 hover:text-red-900 p-1"><i data-lucide="trash-2" class="h-5 w-5"></i></button>
                                </td>
                            </tr>
                        `).join('') || `<tr><td colspan="4" class="text-center p-4 text-gray-500">Nenhum cliente cadastrado.</td></tr>`}
                    </tbody>
                </table>`;
            lucide.createIcons();
        }

        function renderProducts() {
            const list = document.getElementById('products-list');
            if (!list) return;
            list.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome do Produto</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SKU</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Preço</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estoque</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${products.map(p => `
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${p.name}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${p.sku || 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">R$ ${p.price.toFixed(2)}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${p.stock !== null ? p.stock : 'N/A'}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p.status ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                        ${p.status ? 'Ativo' : 'Inativo'}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                    <button onclick="openProductModal(${p.id})" class="text-indigo-600 hover:text-indigo-900 p-1"><i data-lucide="edit" class="h-5 w-5"></i></button>
                                    <button onclick="deleteProduct(${p.id})" class="text-red-600 hover:text-red-900 p-1"><i data-lucide="trash-2" class="h-5 w-5"></i></button>
                                </td>
                            </tr>
                        `).join('') || `<tr><td colspan="6" class="text-center p-4 text-gray-500">Nenhum produto cadastrado.</td></tr>`}
                    </tbody>
                </table>`;
            lucide.createIcons();
        }

        function renderOrders() {
            const list = document.getElementById('orders-list');
            if (!list) return;

            const getStatusBadge = (status) => {
                switch (status) {
                    case 'Faturado': return 'bg-green-100 text-green-800';
                    case 'Cancelado': return 'bg-red-100 text-red-800';
                    case 'Aberto':
                    default:
                        return 'bg-blue-100 text-blue-800';
                }
            };

            list.innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${orders.map(o => {
                            const customer = customers.find(c => c.id === o.customerId);
                            return `
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">#${o.id}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${customer ? customer.name : 'Cliente Removido'}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(o.date).toLocaleDateString('pt-BR')}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${o.type === 'Pedido' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                            ${o.type}
                                        </span>
                                    </td>
                                     <td class="px-6 py-4 whitespace-nowrap text-sm">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusBadge(o.status)}">
                                            ${o.status}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-semibold">R$ ${o.total.toFixed(2)}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <button onclick="openOrderModal(${o.id})" class="text-indigo-600 hover:text-indigo-900 p-1"><i data-lucide="edit" class="h-5 w-5"></i></button>
                                        <button onclick="deleteOrder(${o.id})" class="text-red-600 hover:text-red-900 p-1"><i data-lucide="trash-2" class="h-5 w-5"></i></button>
                                    </td>
                                </tr>
                            `
                        }).join('') || `<tr><td colspan="7" class="text-center p-4 text-gray-500">Nenhum pedido ou orçamento encontrado.</td></tr>`}
                    </tbody>
                </table>`;
            lucide.createIcons();
        }

        function updateStats() {
            document.getElementById('total-orders-stat').textContent = orders.length;
            document.getElementById('total-products-stat').textContent = products.length;
            document.getElementById('total-customers-stat').textContent = customers.length;
            const totalRevenue = orders.filter(o => o.status === 'Faturado').reduce((sum, o) => sum + o.total, 0);
            document.getElementById('total-revenue-stat').textContent = `R$ ${totalRevenue.toFixed(2).replace('.', ',')}`;
        }

        function renderAll() {
            renderCustomers();
            renderProducts();
            renderOrders();
            updateStats();
        }

        // --- MODAL & DIALOG FUNCTIONS ---
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('modal-open');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('modal-open');
             if (modalId === 'orderModal') {
                document.getElementById('orderForm').reset();
                document.getElementById('editingOrderId').value = '';
                currentOrderItems = [];
            } else if (modalId === 'productModal') {
                document.getElementById('productForm').reset();
                document.getElementById('editingProductId').value = '';
            } else if (modalId === 'customerModal') {
                document.getElementById('customerForm').reset();
                document.getElementById('editingCustomerId').value = '';
            }
        }
        
        // Generic function to show alerts or confirmations
        function showInfoModal({ title, message, confirmText = 'Confirmar', cancelText = 'Cancelar', onConfirm, onCancel, isConfirmation = true }) {
            document.getElementById('infoModalTitle').textContent = title;
            document.getElementById('infoModalMessage').textContent = message;
            
            const confirmBtn = document.getElementById('infoModalConfirmBtn');
            const cancelBtn = document.getElementById('infoModalCancelBtn');

            confirmBtn.textContent = confirmText;
            cancelBtn.textContent = cancelText;

            // Clone and replace to remove old event listeners
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            const newCancelBtn = cancelBtn.cloneNode(true);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

            if (isConfirmation) {
                newConfirmBtn.style.display = '';
                newCancelBtn.style.display = '';
                newConfirmBtn.onclick = () => {
                    if(onConfirm) onConfirm();
                    closeModal('infoModal');
                };
                newCancelBtn.onclick = () => {
                    if(onCancel) onCancel();
                    closeModal('infoModal');
                };
            } else { // It's an alert
                newConfirmBtn.textContent = 'OK';
                newConfirmBtn.style.display = '';
                newCancelBtn.style.display = 'none';
                newConfirmBtn.onclick = () => closeModal('infoModal');
            }
            
            openModal('infoModal');
        }


        // --- FORM LOGIC & CRUD OPERATIONS ---
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const editingCustomerId = parseInt(document.getElementById('editingCustomerId').value);
            const customerData = {
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone: document.getElementById('customerPhone').value
            };
            if (editingCustomerId) {
                const customerIndex = customers.findIndex(c => c.id === editingCustomerId);
                if (customerIndex > -1) {
                    customers[customerIndex] = { ...customers[customerIndex], ...customerData };
                }
            } else {
                customerData.id = customers.length > 0 ? Math.max(...customers.map(c => c.id)) + 1 : 1;
                customers.push(customerData);
            }
            closeModal('customerModal');
            renderAll();
        });

        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const editingProductId = parseInt(document.getElementById('editingProductId').value);
            const productData = {
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value) || 0,
                sku: document.getElementById('productSku').value,
                status: document.getElementById('productStatus').checked,
                unit: document.getElementById('productUnit').value,
                weight: parseFloat(document.getElementById('productWeight').value) || 0,
                grossWeight: parseFloat(document.getElementById('productGrossWeight').value) || 0,
                width: parseFloat(document.getElementById('productWidth').value) || 0,
                height: parseFloat(document.getElementById('productHeight').value) || 0,
                depth: parseFloat(document.getElementById('productDepth').value) || 0,
                stock: parseInt(document.getElementById('productStock').value)
            };

            if (isNaN(productData.stock)) {
                productData.stock = null;
            }

            if (editingProductId) {
                const productIndex = products.findIndex(p => p.id === editingProductId);
                if (productIndex > -1) {
                    products[productIndex] = { ...products[productIndex], ...productData };
                }
            } else {
                productData.id = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                products.push(productData);
            }
            closeModal('productModal');
            renderAll();
        });

        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (currentOrderItems.length === 0) {
                showInfoModal({
                    title: 'Pedido Vazio',
                    message: 'Adicione pelo menos um item ao pedido antes de salvar.',
                    isConfirmation: false
                });
                return;
            }
            const editingOrderId = parseInt(document.getElementById('editingOrderId').value);
            const total = currentOrderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const orderData = {
                customerId: parseInt(document.getElementById('orderCustomer').value),
                type: document.getElementById('orderType').value,
                status: document.getElementById('orderStatus').value,
                date: new Date().toISOString().split('T')[0],
                items: [...currentOrderItems],
                total: total
            };
            if (editingOrderId) {
                const orderIndex = orders.findIndex(o => o.id === editingOrderId);
                if (orderIndex > -1) {
                    orders[orderIndex] = { ...orders[orderIndex], ...orderData };
                }
            } else {
                orderData.id = orders.length > 0 ? Math.max(...orders.map(o => o.id)) + 1 : 1;
                orders.push(orderData);
            }
            closeModal('orderModal');
            renderAll();
        });
        
        // --- CUSTOMER MODAL & ACTIONS ---
        function openCustomerModal(customerId = null) {
            const form = document.getElementById('customerForm');
            form.reset();
            const title = document.getElementById('customerModalTitle');
            const editingCustomerIdInput = document.getElementById('editingCustomerId');

            if (customerId) {
                const customer = customers.find(c => c.id === customerId);
                if(customer) {
                    title.textContent = `Editar Cliente #${customerId}`;
                    editingCustomerIdInput.value = customerId;
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('customerEmail').value = customer.email;
                    document.getElementById('customerPhone').value = customer.phone;
                }
            } else {
                title.textContent = 'Adicionar Novo Cliente';
                editingCustomerIdInput.value = '';
            }
            openModal('customerModal');
        }

        function deleteCustomer(customerId) {
            showInfoModal({
                title: 'Excluir Cliente',
                message: 'Tem certeza que deseja excluir este cliente? Esta ação não pode ser desfeita.',
                onConfirm: () => {
                    const customerIndex = customers.findIndex(c => c.id === customerId);
                    if (customerIndex > -1) {
                        customers.splice(customerIndex, 1);
                        renderAll();
                    }
                }
            });
        }
        
        // --- PRODUCT MODAL & ACTIONS ---
        function openProductModal(productId = null) {
            const form = document.getElementById('productForm');
            form.reset();
            const title = document.getElementById('productModalTitle');
            const subtitle = document.getElementById('productModalSubtitle');
            const editingProductIdInput = document.getElementById('editingProductId');
            const statusToggle = document.getElementById('productStatus');
            const statusLabel = document.getElementById('productStatusLabel');

            const updateStatusLabel = () => {
                statusLabel.textContent = statusToggle.checked ? 'Ativo' : 'Inativo';
            };
            statusToggle.removeEventListener('change', updateStatusLabel); // Avoid multiple listeners
            statusToggle.addEventListener('change', updateStatusLabel);

            if (productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    title.textContent = 'Editar Produto';
                    subtitle.textContent = `Editando: ${product.name}`;
                    editingProductIdInput.value = productId;

                    document.getElementById('productName').value = product.name;
                    document.getElementById('productSku').value = product.sku;
                    statusToggle.checked = product.status;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productUnit').value = product.unit;
                    document.getElementById('productWeight').value = product.weight;
                    document.getElementById('productGrossWeight').value = product.grossWeight;
                    document.getElementById('productWidth').value = product.width;
                    document.getElementById('productHeight').value = product.height;
                    document.getElementById('productDepth').value = product.depth;
                    document.getElementById('productStock').value = product.stock;
                }
            } else {
                title.textContent = 'Novo Produto';
                subtitle.textContent = 'Preencha os detalhes do produto abaixo.';
                editingProductIdInput.value = '';
                statusToggle.checked = true; // Default to active
            }
            updateStatusLabel();
            openModal('productModal');
        }

        function deleteProduct(productId) {
             showInfoModal({
                title: 'Excluir Produto',
                message: 'Tem certeza que deseja excluir este produto?',
                onConfirm: () => {
                    const productIndex = products.findIndex(p => p.id === productId);
                    if (productIndex > -1) {
                        products.splice(productIndex, 1);
                        renderAll();
                    }
                }
            });
        }
        
        // --- ORDER MODAL & ACTIONS ---
        function openOrderModal(orderId = null) {
            const form = document.getElementById('orderForm');
            form.reset();
            const title = document.getElementById('orderModalTitle');
            const editingOrderIdInput = document.getElementById('editingOrderId');
            populateOrderFormSelects();

            if (orderId) {
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    title.textContent = `Editar Pedido #${orderId}`;
                    editingOrderIdInput.value = orderId;
                    document.getElementById('orderCustomer').value = order.customerId;
                    document.getElementById('orderType').value = order.type;
                    document.getElementById('orderStatus').value = order.status;
                    currentOrderItems = JSON.parse(JSON.stringify(order.items));
                }
            } else {
                title.textContent = 'Criar Novo Pedido/Orçamento';
                editingOrderIdInput.value = '';
                document.getElementById('orderStatus').value = 'Aberto'; // Default status
                currentOrderItems = [];
            }
            renderOrderItems();
            updateOrderTotal();
            openModal('orderModal');
        }

        function deleteOrder(orderId) {
            showInfoModal({
                title: 'Excluir Pedido',
                message: 'Tem certeza que deseja excluir este pedido/orçamento?',
                onConfirm: () => {
                    const orderIndex = orders.findIndex(o => o.id === orderId);
                    if (orderIndex > -1) {
                        orders.splice(orderIndex, 1);
                        renderAll();
                    }
                }
            });
        }

        function populateOrderFormSelects() {
            const customerSelect = document.getElementById('orderCustomer');
            customerSelect.innerHTML = customers.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            const productSelect = document.getElementById('productSelector');
            productSelect.innerHTML = products.filter(p => p.status).map(p => `<option value="${p.id}">${p.name} - R$ ${p.price.toFixed(2)}</option>`).join('');
        }

        function renderOrderItems() {
            const container = document.getElementById('orderItemsContainer');
            container.innerHTML = currentOrderItems.map((item, index) => {
                const product = products.find(p => p.id === item.productId);
                return `
                <div class="flex justify-between items-center bg-gray-100 p-2 rounded-md">
                    <div>
                        <p class="font-medium">${product ? product.name : 'Produto removido'}</p>
                        <p class="text-sm text-gray-600">${item.quantity} x R$ ${item.price.toFixed(2)}</p>
                    </div>
                    <button type="button" onclick="removeOrderItem(${index})" class="text-red-500 hover:text-red-700"><i data-lucide="trash-2" class="h-5 w-5"></i></button>
                </div>`;
            }).join('');
            lucide.createIcons();
        }

        function updateOrderTotal() {
            const total = currentOrderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('orderTotal').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        document.getElementById('addOrderItem').addEventListener('click', function() {
            const productId = parseInt(document.getElementById('productSelector').value);
            const quantity = parseInt(document.getElementById('itemQuantity').value);
            const product = products.find(p => p.id === productId);
            if (product && quantity > 0) {
                const existingItem = currentOrderItems.find(item => item.productId === productId);
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    currentOrderItems.push({ productId: product.id, quantity: quantity, price: product.price });
                }
                renderOrderItems();
                updateOrderTotal();
            }
        });

        function removeOrderItem(index) {
            currentOrderItems.splice(index, 1);
            renderOrderItems();
            updateOrderTotal();
        }

        // --- TAB NAVIGATION ---
        const tabLinks = document.querySelectorAll('.tab-link');
        tabLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const tab = link.dataset.tab;
                document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('tab-active'));
                link.classList.add('tab-active');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('hidden', content.id !== tab);
                });
                window.location.hash = tab;
            });
        });

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Check hash for initial tab
            const initialTab = window.location.hash.replace('#', '') || 'dashboard';
            const initialLink = document.querySelector(`.tab-link[data-tab="${initialTab}"]`);
            
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.getElementById(initialTab)?.classList.remove('hidden');
            
            document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('tab-active'));
            if(initialLink) {
                initialLink.classList.add('tab-active');
            } else {
                 document.querySelector('.tab-link[data-tab="dashboard"]').classList.add('tab-active');
            }
            
            renderAll();
        });

    </script>
</body>
</html>
